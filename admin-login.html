<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CashBridge | Admin Login</title>

<!-- GOOGLE FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">

<!-- FONT AWESOME -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<!-- SWEETALERT2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Inter',sans-serif;
}

:root{
  --primary:#22c55e;
  --primary-dark:#16a34a;
  --accent:#38bdf8;
  --bg-dark:#020617;
  --bg-card:#0f172a;
  --border:#1e293b;
  --text:#e2e8f0;
  --text-light:#94a3b8;
}

body{
  background:linear-gradient(135deg,#020617,#0a0f1e,#020617);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  position:relative;
  overflow:hidden;
}

body::before{
  content:'';
  position:absolute;
  width:500px;
  height:500px;
  background:radial-gradient(circle,rgba(34,197,94,0.15),transparent);
  border-radius:50%;
  top:-250px;
  right:-250px;
  animation:float 20s infinite ease-in-out;
}

body::after{
  content:'';
  position:absolute;
  width:400px;
  height:400px;
  background:radial-gradient(circle,rgba(56,189,248,0.1),transparent);
  border-radius:50%;
  bottom:-200px;
  left:-200px;
  animation:float 15s infinite ease-in-out reverse;
}

@keyframes float{
  0%,100%{transform:translate(0,0) scale(1)}
  50%{transform:translate(30px,30px) scale(1.1)}
}

.login-container{
  width:100%;
  max-width:480px;
  position:relative;
  z-index:10;
  animation:slideUp 0.8s ease;
}

@keyframes slideUp{
  from{opacity:0;transform:translateY(40px)}
  to{opacity:1;transform:translateY(0)}
}

.admin-card{
  background:linear-gradient(145deg,rgba(15,23,42,0.95),rgba(15,23,42,0.85));
  backdrop-filter:blur(20px);
  border-radius:30px;
  padding:3rem 2.5rem;
  border:1px solid rgba(34,197,94,0.2);
  box-shadow:0 25px 70px rgba(0,0,0,0.7);
  position:relative;
  overflow:hidden;
}

.admin-card::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:4px;
  background:linear-gradient(90deg,var(--primary),var(--accent),var(--primary));
  background-size:200% 100%;
  animation:shimmer 3s infinite;
}

@keyframes shimmer{
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}

.header{
  text-align:center;
  margin-bottom:2.5rem;
}

.shield-icon{
  width:80px;
  height:80px;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  border-radius:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto 1.5rem;
  box-shadow:0 10px 30px rgba(34,197,94,0.3);
  animation:pulse 2s infinite;
}

.shield-icon i{
  font-size:2.5rem;
  color:#020617;
}

@keyframes pulse{
  0%,100%{transform:scale(1);box-shadow:0 10px 30px rgba(34,197,94,0.3)}
  50%{transform:scale(1.05);box-shadow:0 15px 40px rgba(34,197,94,0.5)}
}

.logo{
  font-family:'Playfair Display',serif;
  font-size:2rem;
  font-weight:800;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-bottom:0.5rem;
  letter-spacing:-0.5px;
}

.subtitle{
  color:var(--text-light);
  font-size:0.9rem;
  font-weight:500;
  letter-spacing:1px;
}

.form-group{
  margin-bottom:1.5rem;
}

label{
  display:block;
  margin-bottom:0.6rem;
  color:var(--text);
  font-weight:600;
  font-size:0.9rem;
  display:flex;
  align-items:center;
  gap:0.5rem;
}

label i{
  color:var(--primary);
}

.input-wrapper{
  position:relative;
}

input{
  width:100%;
  padding:1rem 1rem 1rem 3rem;
  border-radius:14px;
  border:2px solid var(--border);
  background:rgba(2,6,23,0.6);
  color:var(--text);
  outline:none;
  font-size:0.95rem;
  transition:all 0.3s;
  font-weight:500;
}

input:focus{
  border-color:var(--primary);
  background:rgba(2,6,23,0.8);
  box-shadow:0 0 0 4px rgba(34,197,94,0.1);
}

.input-icon{
  position:absolute;
  left:1rem;
  top:50%;
  transform:translateY(-50%);
  color:var(--text-light);
  font-size:1.1rem;
  transition:all 0.3s;
  pointer-events:none;
}

input:focus + .input-icon{
  color:var(--primary);
  transform:translateY(-50%) scale(1.1);
}

.toggle-password{
  position:absolute;
  right:1rem;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  color:var(--text-light);
  cursor:pointer;
  padding:0.5rem;
  font-size:1.1rem;
  transition:all 0.3s;
  border-radius:8px;
  width:auto;
}

.toggle-password:hover{
  color:var(--primary);
  background:rgba(34,197,94,0.1);
}

.toggle-password:active{
  transform:translateY(-50%) scale(0.95);
}

.btn-login{
  width:100%;
  padding:1.1rem;
  margin-top:1rem;
  border-radius:14px;
  border:none;
  font-weight:700;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#020617;
  cursor:pointer;
  font-size:1rem;
  letter-spacing:0.5px;
  text-transform:uppercase;
  transition:all 0.3s;
  box-shadow:0 10px 25px rgba(34,197,94,0.3);
  position:relative;
  overflow:hidden;
}

.btn-login::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);
  transition:left 0.5s;
}

.btn-login:hover::before{
  left:100%;
}

.btn-login:hover{
  transform:translateY(-2px);
  box-shadow:0 15px 35px rgba(34,197,94,0.4);
}

.btn-login:active{
  transform:translateY(0);
}

.btn-login:disabled{
  opacity:0.6;
  cursor:not-allowed;
  transform:none;
}

.btn-login i{
  margin-right:0.5rem;
}

.footer{
  margin-top:2rem;
  padding-top:1.5rem;
  border-top:1px solid var(--border);
  text-align:center;
}

.footer a{
  color:var(--accent);
  text-decoration:none;
  font-weight:600;
  font-size:0.9rem;
  transition:all 0.3s;
  display:inline-flex;
  align-items:center;
  gap:0.5rem;
}

.footer a:hover{
  color:var(--primary);
  gap:0.7rem;
}

@media(max-width:500px){
  .admin-card{
    padding:2rem 1.5rem;
  }
  
  .logo{
    font-size:1.75rem;
  }
  
  .shield-icon{
    width:70px;
    height:70px;
  }
  
  .shield-icon i{
    font-size:2rem;
  }
}

/* Custom SweetAlert2 Styling */
.swal2-popup{
  background:#0f172a !important;
  border:1px solid rgba(34,197,94,0.2) !important;
  border-radius:24px !important;
}

.swal2-title{
  color:var(--text) !important;
}

.swal2-html-container{
  color:var(--text-light) !important;
}

.swal2-confirm{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark)) !important;
  color:#020617 !important;
  border-radius:12px !important;
  font-weight:700 !important;
  padding:0.8rem 2rem !important;
}
</style>
</head>

<body>

<div class="login-container">
  <div class="admin-card">
    <div class="header">
      <div class="shield-icon">
        <i class="fas fa-shield-halved"></i>
      </div>
      <div class="logo">CashBridge</div>
      <div class="subtitle">ðŸ”’ ADMINISTRATOR ACCESS ONLY</div>
    </div>

    <form id="adminLoginForm">
      <div class="form-group">
        <label>
          <i class="fas fa-envelope"></i>
          Email Address
        </label>
        <div class="input-wrapper">
          <input type="email" id="email" placeholder="admin@cashbridge.com" required autocomplete="email">
          <i class="fas fa-at input-icon"></i>
        </div>
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-lock"></i>
          Password
        </label>
        <div class="input-wrapper">
          <input type="password" id="password" placeholder="Enter your password" required autocomplete="current-password">
          <i class="fas fa-key input-icon"></i>
          <button type="button" class="toggle-password" id="togglePassword" aria-label="Toggle password visibility">
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </div>

      <button class="btn-login" id="loginBtn" type="submit">
        <i class="fas fa-sign-in-alt"></i> Login to Dashboard
      </button>
    </form>

    <div class="footer">
      <a href="login.html">
        <i class="fas fa-arrow-left"></i>
        Back to User Login
      </a>
    </div>
  </div>
</div>

<!-- FIREBASE MODULAR SDK (MATCHES DASHBOARD) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCubmbN-jRq33AHGL7WxxeILOrV-1_QCxo",
  authDomain: "cashbridge-a688e.firebaseapp.com",
  projectId: "cashbridge-a688e",
  storageBucket: "cashbridge-a688e.firebasestorage.app",
  messagingSenderId: "345273765518",
  appId: "1:345273765518:web:29ee0b8f9717cdb50203df"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Set persistence to LOCAL (will survive page refresh)
await setPersistence(auth, browserLocalPersistence);

console.log('Admin login page initialized');

/* PASSWORD TOGGLE */
document.getElementById("togglePassword").onclick = () => {
  const p = document.getElementById("password");
  const icon = document.querySelector("#togglePassword i");
  if (p.type === "password") {
    p.type = "text";
    icon.classList.remove("fa-eye");
    icon.classList.add("fa-eye-slash");
  } else {
    p.type = "password";
    icon.classList.remove("fa-eye-slash");
    icon.classList.add("fa-eye");
  }
};

/* LOGIN FORM */
document.getElementById("adminLoginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const btn = document.getElementById("loginBtn");
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;

  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';

  try {
    console.log('Attempting login for:', email);
    
    // Sign in
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const uid = userCredential.user.uid;

    console.log("User signed in:", uid);

    // Check if user is admin
    const userDoc = await getDoc(doc(db, "users", uid));

    if (!userDoc.exists()) {
      console.error("User document not found");
      await auth.signOut();
      throw new Error("User profile not found");
    }

    const userData = userDoc.data();
    console.log("User role:", userData.role);

    if (userData.role !== "admin") {
      console.error("User is not admin");
      await auth.signOut();
      
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login to Dashboard';
      
      Swal.fire({
        icon: "error",
        title: "Access Denied",
        html: "<p>This account does not have administrator privileges.</p><p style='color:#94a3b8;margin-top:0.5rem;font-size:0.9rem'>Contact system administrator for access.</p>",
        confirmButtonText: "OK",
        confirmButtonColor: "#ef4444"
      });
      return;
    }

    // SUCCESS - Admin verified
    console.log("Admin verified, redirecting...");
    
    Swal.fire({
      icon: "success",
      title: "Welcome Back, Admin!",
      html: "<p>Authentication successful</p><p style='color:#94a3b8;margin-top:0.5rem'>Redirecting to dashboard...</p>",
      timer: 1800,
      showConfirmButton: false,
      willClose: () => {
        window.location.href = "admin-dashboard.html";
      }
    });

  } catch (err) {
    console.error("Login error:", err);
    
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login to Dashboard';

    let errorTitle = "Login Failed";
    let errorMessage = "An error occurred. Please try again.";

    if (err.code === "auth/wrong-password" || err.code === "auth/invalid-credential") {
      errorTitle = "Invalid Credentials";
      errorMessage = "Incorrect email or password.";
    } else if (err.code === "auth/user-not-found") {
      errorTitle = "Account Not Found";
      errorMessage = "No admin account exists with this email.";
    } else if (err.code === "auth/invalid-email") {
      errorTitle = "Invalid Email";
      errorMessage = "Please enter a valid email address.";
    } else if (err.code === "auth/too-many-requests") {
      errorTitle = "Too Many Attempts";
      errorMessage = "Access temporarily disabled. Please try again later.";
    } else if (err.code === "auth/network-request-failed") {
      errorTitle = "Network Error";
      errorMessage = "Please check your internet connection.";
    } else if (err.message) {
      errorMessage = err.message;
    }

    Swal.fire({
      icon: "error",
      title: errorTitle,
      text: errorMessage,
      confirmButtonText: "Try Again",
      confirmButtonColor: "#ef4444"
    });
  }
});
</script>

</body>
</html>